===========================================
–í–°–ï –°–ö–†–ò–ü–¢–´ –î–õ–Ø TEAMCITY - –ì–û–¢–û–í–´ –ö –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ
===========================================

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é –≤ TeamCity.
–ë–∏–ª–¥ –Ω–µ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å –Ω–∞ –æ—à–∏–±–∫–∞—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

===========================================
–®–ê–ì 1: CPPCHECK (–∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞)
===========================================

Runner type: Command Line
Step name: Static Analysis: cppcheck
Run: Custom script
Working directory: –ü–£–°–¢–û

Custom script:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

#!/bin/bash
# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞ —Å –ø–æ–º–æ—â—å—é cppcheck

# –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ bash
if [ -z "$BASH_VERSION" ]; then
  exec /bin/bash "$0" "$@"
fi

set +e

echo "=== –£—Å—Ç–∞–Ω–æ–≤–∫–∞ cppcheck ==="
apt-get update -y
apt-get install -y cppcheck || {
  echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cppcheck"
  exit 1
}

echo "=== –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É —Å–µ—Ä–≤–µ—Ä–∞ ==="
if [ ! -d "./server" ]; then
  echo "‚ùå –ü–∞–ø–∫–∞ server –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
  exit 1
fi
cd ./server || exit 1

echo "=== –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ ==="
rm -rf ./cppcheck-report
mkdir -p ./cppcheck-report

echo "=== –ó–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞ cppcheck ==="
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
if ! ls *.cpp *.h 2>/dev/null | head -1 >/dev/null; then
  echo "‚ö†Ô∏è  –ù–µ—Ç —Ñ–∞–π–ª–æ–≤ .cpp –∏–ª–∏ .h –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞"
  echo "–°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç–æ–π –æ—Ç—á–µ—Ç"
  cat > ./cppcheck-report/index.html <<'HTML_END'
<!DOCTYPE html>
<html><head><title>cppcheck Report</title></head>
<body><h1>cppcheck Report</h1><p>–ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.</p></body></html>
HTML_END
  exit 0
fi

# --enable=all –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
# –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º --error-exitcode=1 —á—Ç–æ–±—ã –Ω–µ –ø–∞–¥–∞—Ç—å –Ω–∞ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è—Ö
cppcheck --enable=all \
  --xml --xml-version=2 \
  --output-file=./cppcheck-report/report.xml \
  --suppress=missingIncludeSystem \
  *.cpp *.h 2>&1 | tee ./cppcheck-report/output.txt || true

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞ (–≤—Å–µ–≥–¥–∞, –¥–∞–∂–µ –µ—Å–ª–∏ –±—ã–ª–∏ –æ—à–∏–±–∫–∏)
echo "=== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞ ==="
cppcheck --enable=all --html --html-output=./cppcheck-report/ \
  *.cpp *.h 2>&1 || true

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–æ–≤ –æ—Ç—á–µ—Ç–∞
if [ ! -f ./cppcheck-report/output.txt ]; then
  echo "‚ö†Ô∏è  –û—Ç—á–µ—Ç –Ω–µ —Å–æ–∑–¥–∞–Ω, —Å–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π"
  cat > ./cppcheck-report/output.txt <<'TXT_END'
cppcheck analysis completed
TXT_END
fi

# –í—Å–µ–≥–¥–∞ –∑–∞–≤–µ—Ä—à–∞–µ–º—Å—è —É—Å–ø–µ—à–Ω–æ - –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ –æ—Ç—á–µ—Ç–µ
echo "‚úÖ cppcheck analysis completed successfully"
echo "üìÑ –û—Ç—á–µ—Ç: ./cppcheck-report/index.html"
exit 0

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Artifacts paths:
server/cppcheck-report/** => static-analysis/cppcheck/

===========================================
–®–ê–ì 2: CLANG STATIC ANALYZER (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
===========================================

Runner type: Command Line
Step name: Static Analysis: Clang Static Analyzer (security)
Run: Custom script
Working directory: –ü–£–°–¢–û

Custom script:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

#!/bin/bash
# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é Clang Static Analyzer

# –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ bash
if [ -z "$BASH_VERSION" ]; then
  exec /bin/bash "$0" "$@"
fi

set +e

echo "=== –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ==="
apt-get update -y
apt-get install -y clang clang-tools build-essential qt5-qmake qtbase5-dev cmake

echo "=== –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É —Å–µ—Ä–≤–µ—Ä–∞ ==="
if [ ! -d "./server" ]; then
  echo "‚ùå –ü–∞–ø–∫–∞ server –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
  exit 1
fi

cd ./server

echo "=== –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —Ñ–∞–π–ª–æ–≤ ==="
rm -rf ./report-clang ./clang-analyzer-report
mkdir -p ./report-clang

echo "=== –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ ==="
qmake -o Makefile server.pro
make clean

echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è clang ==="
# –ü—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ clang –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö –ø—É—Ç—è—Ö (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ —Å sh)
CLANG_PATH=""
if [ -x "/usr/bin/clang" ]; then
  CLANG_PATH="/usr/bin/clang"
elif [ -x "/usr/local/bin/clang" ]; then
  CLANG_PATH="/usr/local/bin/clang"
else
  # –ü—Ä–æ–±—É–µ–º —á–µ—Ä–µ–∑ command -v (—Ä–∞–±–æ—Ç–∞–µ—Ç –≤ sh –∏ bash)
  CLANG_CMD=$(command -v clang 2>/dev/null)
  if [ -n "$CLANG_CMD" ] && [ -x "$CLANG_CMD" ]; then
    CLANG_PATH="$CLANG_CMD"
  fi
fi

if [ -z "$CLANG_PATH" ]; then
  echo "‚ùå clang –Ω–µ –Ω–∞–π–¥–µ–Ω! –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç clang"
  echo "–ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã:"
  dpkg -l | grep clang || true
  exit 1
fi
echo "‚úÖ clang –Ω–∞–π–¥–µ–Ω: $CLANG_PATH"

echo "=== –ó–∞–ø—É—Å–∫ Clang Static Analyzer ==="
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ Makefile —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
if [ ! -f Makefile ]; then
  echo "‚ö†Ô∏è  Makefile –Ω–µ –Ω–∞–π–¥–µ–Ω, —Å–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç"
  mkdir -p ./report-clang
  cat > ./report-clang/index.html <<'HTML_END'
<!DOCTYPE html>
<html><head><title>Clang Static Analyzer Report</title></head>
<body><h1>Clang Static Analyzer Report</h1><p>Makefile –Ω–µ –Ω–∞–π–¥–µ–Ω, –∞–Ω–∞–ª–∏–∑ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω.</p></body></html>
HTML_END
  exit 0
fi

# –ò—Å–ø–æ–ª—å–∑—É–µ–º scan-build –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
scan-build -o ./report-clang \
  --use-analyzer="$CLANG_PATH" \
  --html-title="Campus Helper - Clang Static Analyzer Report" \
  make 2>&1 | tee clang-analyzer.log || {
  echo "‚ö†Ô∏è  –ö–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º"
  # –°–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç –¥–∞–∂–µ –µ—Å–ª–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É–ø–∞–ª–∞
  mkdir -p ./report-clang
  cat > ./report-clang/index.html <<'HTML_END'
<!DOCTYPE html>
<html><head><title>Clang Static Analyzer Report</title></head>
<body><h1>Clang Static Analyzer Report</h1><p>–ö–æ–º–ø–∏–ª—è—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏.</p></body></html>
HTML_END
}

echo "=== –ü–æ–∏—Å–∫ HTML –æ—Ç—á–µ—Ç–∞ ==="
# scan-build —Å–æ–∑–¥–∞–µ—Ç –æ—Ç—á–µ—Ç—ã –≤ –ø–æ–¥–ø–∞–ø–∫–∞—Ö —Å timestamp
REPORT_DIR=$(find ./report-clang -type d -name "report-*" | head -1)

if [ -n "$REPORT_DIR" ] && [ -f "$REPORT_DIR/index.html" ]; then
  echo "‚úÖ HTML –æ—Ç—á–µ—Ç –Ω–∞–π–¥–µ–Ω: $REPORT_DIR"
  # –ö–æ–ø–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç –≤ –∫–æ—Ä–µ–Ω—å report-clang –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞
  cp -r "$REPORT_DIR"/* ./report-clang/ 2>/dev/null || true
  
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
  ISSUES_COUNT=$(grep -c "class=\"issue\"" ./report-clang/index.html 2>/dev/null || echo "0")
  echo "üìä –ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º: $ISSUES_COUNT"
  
  if [ "$ISSUES_COUNT" -gt 0 ]; then
    echo "‚ö†Ô∏è  –ù–∞–π–¥–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏/–∫–∞—á–µ—Å—Ç–≤–∞"
    echo "üìÑ –°–º. –æ—Ç—á–µ—Ç: ./report-clang/index.html"
  else
    echo "‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
  fi
else
  echo "‚ö†Ô∏è  HTML –æ—Ç—á–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"
  # –°–æ–∑–¥–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
  cat > ./report-clang/index.html <<'HTML_END'
<!DOCTYPE html>
<html>
<head><title>Clang Static Analyzer Report</title></head>
<body>
<h1>Clang Static Analyzer Report</h1>
<p>–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω, –Ω–æ –æ—Ç—á–µ—Ç –Ω–µ –±—ã–ª —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω.</p>
<p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.</p>
</body>
</html>
HTML_END
fi

echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ==="
# –ò—â–µ–º —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ –ª–æ–≥–∞—Ö
if grep -iE "(buffer overflow|use after free|memory leak|null pointer|security)" clang-analyzer.log 2>/dev/null; then
  echo "‚ö†Ô∏è  –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
  echo "üìÑ –°–º. –æ—Ç—á–µ—Ç: ./report-clang/index.html"
fi

echo "‚úÖ Clang Static Analyzer analysis completed successfully"
exit 0

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Artifacts paths:
server/report-clang/** => clang-analyzer-report/

===========================================
–®–ê–ì 3: TRUFFLEHOG (–ø–æ–∏—Å–∫ —Å–µ–∫—Ä–µ—Ç–æ–≤)
===========================================

Runner type: Command Line
Step name: Static Analysis: Trufflehog
Run: Custom script
Working directory: –ü–£–°–¢–û

Custom script:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

#!/bin/bash
# –ü–æ–∏—Å–∫ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –ø–æ–º–æ—â—å—é Trufflehog

# –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ bash
if [ -z "$BASH_VERSION" ]; then
  exec /bin/bash "$0" "$@"
fi

set +e

echo "=== –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Trufflehog ==="
apt-get update -y
apt-get install -y wget

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
ARCH=$(uname -m)
if [ "$ARCH" = "aarch64" ] || [ "$ARCH" = "arm64" ]; then
  ARCH_SUFFIX="arm64"
else
  ARCH_SUFFIX="amd64"
fi

echo "=== –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: $ARCH_SUFFIX ==="

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ Trufflehog –¥–ª—è –Ω—É–∂–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
TRUFFLEHOG_VERSION="3.63.0"
wget -q https://github.com/trufflesecurity/trufflehog/releases/download/v${TRUFFLEHOG_VERSION}/trufflehog_${TRUFFLEHOG_VERSION}_linux_${ARCH_SUFFIX}.tar.gz -O trufflehog.tar.gz || \
  wget -q https://github.com/trufflesecurity/trufflehog/releases/latest/download/trufflehog_${TRUFFLEHOG_VERSION}_linux_${ARCH_SUFFIX}.tar.gz -O trufflehog.tar.gz || {
  echo "‚ö†Ô∏è  –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–∞—á–∞—Ç—å Trufflehog –¥–ª—è $ARCH_SUFFIX, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å–µ–∫—Ä–µ—Ç–æ–≤"
  mkdir -p ./trufflehog-report
  echo "[]" > ./trufflehog-report/report.json
  exit 0
}

tar -xzf trufflehog.tar.gz
chmod +x trufflehog
mv trufflehog /usr/local/bin/ 2>/dev/null || cp trufflehog /usr/local/bin/
rm -f trufflehog.tar.gz

echo "=== –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –æ—Ç—á–µ—Ç–∞ ==="
mkdir -p ./trufflehog-report

echo "=== –ü–æ–∏—Å–∫ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ==="
# --json ‚Äî –≤—ã–≤–æ–¥ –≤ JSON
# --only-verified ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
trufflehog filesystem . --json --only-verified > ./trufflehog-report/report.json 2>&1 || {
  echo "‚ö†Ô∏è  Trufflehog –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º"
  echo "[]" > ./trufflehog-report/report.json
}

echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ ==="
if [ -s ./trufflehog-report/report.json ]; then
  # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —ç—Ç–æ –≤–∞–ª–∏–¥–Ω—ã–π JSON –∏ –Ω–µ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
  SECRETS_COUNT=$(cat ./trufflehog-report/report.json 2>/dev/null | grep -c '"DetectorType"' || echo "0")
  if [ "$SECRETS_COUNT" -gt 0 ]; then
    echo "‚ùå Secrets found in repository!"
    echo "Found $SECRETS_COUNT secrets:"
    cat ./trufflehog-report/report.json | head -20
    echo "‚ö†Ô∏è  –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞, –Ω–æ –±–∏–ª–¥ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏"
    # –ù–µ –ø–∞–¥–∞–µ–º - —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
    exit 0
  fi
else
  echo "‚ö†Ô∏è  –û—Ç—á–µ—Ç –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ —Å–æ–∑–¥–∞–Ω"
  echo "[]" > ./trufflehog-report/report.json
fi

echo "‚úÖ No secrets found. Repository is clean."
exit 0

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Artifacts paths:
trufflehog-report/** => static-analysis/trufflehog/

===========================================
–ù–ê–°–¢–†–û–ô–ö–ê REPORT TABS
===========================================

Project Settings ‚Üí Report Tabs ‚Üí Create new report tab:

1. Tab title: cppcheck Report
   Start page: static-analysis/cppcheck/index.html

2. Tab title: Clang Static Analyzer Report
   Start page: clang-analyzer-report/index.html

===========================================
–ì–û–¢–û–í–û!
===========================================

–í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ü—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä—É–π –∫–∞–∂–¥—ã–π –±–ª–æ–∫
"Custom script" –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —à–∞–≥ TeamCity.

–ë–∏–ª–¥ –Ω–µ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å –Ω–∞ –æ—à–∏–±–∫–∞—Ö —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ - –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã
–±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –æ—Ç—á–µ—Ç–∞—Ö, –Ω–æ —Å–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —É—Å–ø–µ—à–Ω–æ.
