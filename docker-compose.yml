# Сборка и запуск приложения (ЛР3/ЛР5). Без container_name — для CI (нет конфликта имён).
services:
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    image: ${DOCKERHUB_USER:-campus}/campus-helper-server:latest
    # Порт не пробрасываем в CI — контейнер только проверяется на запуск, доступ не нужен
    # Порт 45454 используется только в docker-compose.stage.yml для реального stage-сервера
    environment:
      - DB_PATH=/app/data/campus_helper.db
    volumes:
      - db-data:/app/data
    restart: unless-stopped

volumes:
  db-data:
