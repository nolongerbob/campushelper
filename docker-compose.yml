# Docker Compose для CI (main и feature). Порт НЕ пробрасывается.

services:
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    image: ${DOCKERHUB_USER:-campus}/campus-helper-server:latest
    environment:
      - DB_PATH=/app/data/campus_helper.db
    volumes:
      - db-data:/app/data
    restart: unless-stopped

  # Просмотр схемы БД: docker compose run --rm db-shell .schema
  # Интерактивно: docker compose run --rm db-shell
  db-shell:
    image: keinos/sqlite3:latest
    volumes:
      - db-data:/app/data
    entrypoint: ["sqlite3", "/app/data/campus_helper.db"]

volumes:
  db-data:
